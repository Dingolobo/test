name: Fetch MVSHUB new to XML

on:
  schedule:
    - cron: '0 11 * * *'  # Se ejecuta a las 11:00 AM UTC = 6:00 AM GMT-5
  workflow_dispatch:      # Permite ejecuci√≥n manual desde GitHub 

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up Python 3.11
      uses: actions/setup-python@v4
      with:
        python-version: 3.11

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install playwright requests

    - name: Install Playwright browsers
      run: |
        python -m playwright install

    - name: Run EPG fetch script
      env:
        TIMEZONE_OFFSET: '0'  # Ajusta si quieres otro offset horario
        CHANNEL_IDS: '306, 645, 701, 702, 703, 704, 705, 726, 727, 728, 734, 736, 741, 761, 762, 763, 764, 766, 769, 770, 771, 772, 801, 802, 803, 805, 806, 807, 808, 809, 814, 821, 822, 963, 964, 965, 1062, 1141, 1361, 1445, 1447,  1451'  # Opcional, puedes cambiar o pasar por args
      run: |
        python mvshubnew.py
    
    - name: Commit and push XML
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add mvshub.xml
        git diff --staged --quiet || git commit -m "Actualizado [$(TZ="America/Cancun" date +"%d-%m-%Y %H:%M GMT-5")] - [$(date +'%d-%m-%Y %H:%M UTC')]"
        git push
      env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
